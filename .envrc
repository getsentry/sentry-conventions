# Runs `devenv sync` to install `uv`, `yarn install`, and installs the `pre-commit` hook.

if [[ -x "${PWD}/.devenv/bin/devenv" ]]; then
    DEVENV="${PWD}/.devenv/bin/devenv"
elif command -v devenv >/dev/null 2>&1; then
    DEVENV="devenv"
fi

if [[ -n "$DEVENV" ]]; then
    $DEVENV sync
    PATH_add "${PWD}/.devenv/bin"
fi

if ! command -v uv >/dev/null 2>&1; then
    echo "ERROR: Please install devenv (https://github.com/getsentry/devenv) or uv (https://docs.astral.sh/uv/)"
    return 1
fi

if [ ! -d "node_modules" ]; then
    yarn install
fi

if command -v uvx >/dev/null 2>&1 && [ ! -f ".git/hooks/pre-commit" ]; then
    uvx pre-commit@latest install
fi

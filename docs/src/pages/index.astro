---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

// Get counts for the stats
const attributes = await getCollection('attributes');
const names = await getCollection('names');

const totalAttributes = attributes.length;
const stableAttributes = attributes.filter((a) => !a.data.deprecation).length;
const deprecatedAttributes = totalAttributes - stableAttributes;

// Get unique categories
const categories = new Set(
  attributes.map((a) => {
    const parts = a.id.split('/');
    return parts.length > 1 ? parts[0] : 'general';
  }),
);
---

<BaseLayout title="Home">
  <div class="py-8 mb-8">
    <h1 class="text-3xl font-semibold leading-tight mb-6">
      Sentry Semantic Conventions
    </h1>
    <p class="text-base text-text-secondary mb-4 max-w-3xl leading-relaxed">
      This repository contains the Sentry Semantic Conventions as defined by <a href="https://github.com/getsentry/rfcs/blob/main/text/0116-sentry-semantic-conventions.md" target="_blank" rel="noopener" class="text-accent hover:text-accent-hover">RFC #116</a>.
    </p>
    <p class="text-base text-text-secondary mb-4 max-w-3xl leading-relaxed">
      Sentry's semantic conventions align with <a href="https://opentelemetry.io/docs/concepts/semantic-conventions/" target="_blank" rel="noopener" class="text-accent hover:text-accent-hover">OpenTelemetry's semantic conventions</a>, and currently apply to span, breadcrumb and log attributes (<code class="text-sm">span.data</code> and <code class="text-sm">breadcrumb.data</code> for backwards compatibility).
    </p>
    <p class="text-base text-text-secondary mb-4 max-w-3xl leading-relaxed">
      These will be a standardized naming scheme for operations and data that will be shared across the SDKs, ingest, and the product. This allows us to have a single source of truth for the semantic conventions, and also allows us to generate code for all parts of the stack (ingest, frontend, backend, data pipelines) that need to be aware of this.
    </p>
    <p class="text-base text-text-secondary mb-4 max-w-3xl leading-relaxed">
      Conventions may also map attributes from OpenTelemetry resource attributes into Sentry's semantic attributes. Such OpenTelemetry resource attributes are ingested into Sentry as regular attributes prefixed with <code class="text-sm">resource.</code>.
    </p>
    <div class="flex gap-3 mt-6 flex-col sm:flex-row">
      <a href={`${import.meta.env.BASE_URL}attributes/`} class="btn btn-primary justify-center">
        Browse Attributes
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M5 12h14M12 5l7 7-7 7"/>
        </svg>
      </a>
      <a href="https://github.com/getsentry/sentry-conventions" class="btn btn-secondary justify-center" target="_blank" rel="noopener">
        View on GitHub
      </a>
    </div>
  </div>
  
  <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-12">
    <div class="card text-center">
      <span class="block text-2xl font-semibold text-text-primary mb-1">{totalAttributes}</span>
      <span class="text-xs text-text-muted uppercase tracking-wider">Total Attributes</span>
    </div>
    <div class="card text-center">
      <span class="block text-2xl font-semibold text-text-primary mb-1">{stableAttributes}</span>
      <span class="text-xs text-text-muted uppercase tracking-wider">Stable</span>
    </div>
    <div class="card text-center">
      <span class="block text-2xl font-semibold text-text-primary mb-1">{deprecatedAttributes}</span>
      <span class="text-xs text-text-muted uppercase tracking-wider">Deprecated</span>
    </div>
    <div class="card text-center">
      <span class="block text-2xl font-semibold text-text-primary mb-1">{categories.size}</span>
      <span class="text-xs text-text-muted uppercase tracking-wider">Categories</span>
    </div>
  </div>
  
  <section class="mb-12">
    <h2 class="mb-6 text-xl">What's Inside</h2>
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
      <a href={`${import.meta.env.BASE_URL}attributes/`} class="card group">
        <div class="inline-flex items-center justify-center w-10 h-10 bg-bg-elevated rounded-md text-text-secondary mb-3">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 7V4h16v3M9 20h6M12 4v16"/>
          </svg>
        </div>
        <h3 class="text-base mb-2">Attributes</h3>
        <p class="text-sm m-0 text-text-muted">Browse all {totalAttributes} span and breadcrumb attributes organized by category, with PII information and type definitions.</p>
      </a>
      
      <a href={`${import.meta.env.BASE_URL}names/`} class="card group">
        <div class="inline-flex items-center justify-center w-10 h-10 bg-bg-elevated rounded-md text-text-secondary mb-3">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
            <polyline points="14,2 14,8 20,8"/>
            <line x1="16" y1="13" x2="8" y2="13"/>
            <line x1="16" y1="17" x2="8" y2="17"/>
            <polyline points="10,9 9,9 8,9"/>
          </svg>
        </div>
        <h3 class="text-base mb-2">Span Names</h3>
        <p class="text-sm m-0 text-text-muted">Learn how to construct span names using templates and attributes for different operation types.</p>
      </a>
      
      <a href="https://github.com/getsentry/sentry-conventions/blob/main/CONTRIBUTING.md" class="card group" target="_blank" rel="noopener">
        <div class="inline-flex items-center justify-center w-10 h-10 bg-bg-elevated rounded-md text-text-secondary mb-3">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/>
            <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>
          </svg>
        </div>
        <h3 class="text-base mb-2">Contributing</h3>
        <p class="text-sm m-0 text-text-muted">Add new attributes, propose changes, or help improve the documentation. Open to contributions!</p>
      </a>
    </div>
  </section>
  
  <section>
    <h2 class="mb-4 text-xl">Quick Links</h2>
    <div class="flex flex-wrap gap-2">
      <a href={`${import.meta.env.BASE_URL}attributes/http/`} class="category-chip">HTTP Attributes</a>
      <a href={`${import.meta.env.BASE_URL}attributes/db/`} class="category-chip">Database Attributes</a>
      <a href={`${import.meta.env.BASE_URL}attributes/gen_ai/`} class="category-chip">Gen AI Attributes</a>
      <a href={`${import.meta.env.BASE_URL}attributes/user/`} class="category-chip">User Attributes</a>
      <a href={`${import.meta.env.BASE_URL}attributes/sentry/`} class="category-chip">Sentry-specific</a>
      <a href={`${import.meta.env.BASE_URL}attributes/?deprecated=true`} class="category-chip">Deprecated Attributes</a>
    </div>
  </section>
</BaseLayout>
